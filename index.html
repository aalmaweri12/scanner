<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Extractor & Scanners</title>
    <link rel="stylesheet" href="/css/Extract_Info_styles.css">
    <link rel="stylesheet" href="/css/navigation.css">

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; background-color: #f5f5f5; }
        .scanner-container { display: none; }
        .video-container { position: relative; width: 100%; max-width: 600px; margin: 0 auto; }
        video { width: 100%; max-width: 600px; border: 2px solid #333; display: block; }
        #scan-region { position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%); width: 92%; height: 20%; border: 3px solid red; }
        #scan-region.detected { border-color: #00cc00; }
        .controls { margin-top: 15px; display: flex; justify-content: center; gap: 10px; }
        button { padding: 12px 24px; font-size: 16px; background-color: #4285f4; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #3367d6; }
        textarea { width: 80%; height: 100px; margin-top: 20px; }
    </style>
</head>
<body>

    <h1>Data Extractor & Scanners</h1>

    <div class="scanner-toggle">
        <button onclick="toggleScanner('mrz')">MRZ Scanner</button>
        <button onclick="toggleScanner('pdf417')">PDF417 Scanner</button>
    </div>

    <!-- MRZ Scanner -->
    <div id="mrz-scanner" class="scanner-container">
        <h3>MRZ Scanner</h3>
        <div class="video-container">
            <video id="mrz-video" autoplay playsinline></video>
            <div id="scan-region"></div>
        </div>
        <div class="controls">
            <button onclick="startMRZScanning()">Start Camera</button>
            <button onclick="captureAndProcessMRZ()" disabled>Capture MRZ</button>
        </div>
        <p id="mrz-result">Waiting for scan...</p>
    </div>

    <!-- PDF417 Scanner -->
    <div id="pdf417-scanner" class="scanner-container">
        <h3>PDF417 Scanner</h3>
        <div class="video-container">
            <video id="pdf417-video" autoplay playsinline></video>
        </div>
        <button onclick="startPDF417Scan()">Start Scan</button>
        <p id="pdf417-result">Scan a PDF417 barcode...</p>
    </div>

    <!-- Extracted Data Input -->
    <h2>Extracted Information</h2>
    <textarea id="rawData" placeholder="Scanned data will appear here..."></textarea>

    <div class="output">
        <p><strong>Last Name:</strong> <input type="text" id="lastName"></p>
        <p><strong>First Name:</strong> <input type="text" id="firstName"></p>
        <p><strong>Date of Birth:</strong> <input type="text" id="dob"></p>
        <p><strong>ID Number:</strong> <input type="text" id="idNumber"></p>
    </div>

    <script>
        function toggleScanner(scannerType) {
            document.getElementById("mrz-scanner").style.display = (scannerType === 'mrz') ? "block" : "none";
            document.getElementById("pdf417-scanner").style.display = (scannerType === 'pdf417') ? "block" : "none";
        }

        // MRZ Scanner
        async function startMRZScanning() {
            let mrzVideo = document.getElementById('mrz-video');
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            mrzVideo.srcObject = stream;
        }

        async function captureAndProcessMRZ() {
            let mrzVideo = document.getElementById('mrz-video');
            let canvas = document.createElement('canvas');
            let ctx = canvas.getContext('2d');
            canvas.width = mrzVideo.videoWidth;
            canvas.height = mrzVideo.videoHeight;
            ctx.drawImage(mrzVideo, 0, 0, canvas.width, canvas.height);

            const { data } = await Tesseract.recognize(canvas, 'eng');
            let extractedData = data.text.replace(/\s+/g, ' ').trim();
            document.getElementById("rawData").value = extractedData;
            parseExtractedData(extractedData);
        }

        // PDF417 Scanner
        async function startPDF417Scan() {
            let video = document.getElementById('pdf417-video');
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            video.srcObject = stream;
            const codeReader = new ZXing.BrowserMultiFormatReader();
            codeReader.decodeFromVideoDevice(undefined, video, (result) => {
                if (result) {
                    document.getElementById("rawData").value = result.getText();
                    parseExtractedData(result.getText());
                }
            });
        }

        // Extract Data
        function parseExtractedData(text) {
            let lines = text.split("\n");
            document.getElementById("lastName").value = lines[0] || "";
            document.getElementById("firstName").value = lines[1] || "";
            document.getElementById("dob").value = lines[2] || "";
            document.getElementById("idNumber").value = lines[3] || "";
        }
    </script>

</body>
</html>
